!function(n){function t(n){n.type="event",n.instance=new EventSource(n._url),n.instance.successCount=0,n.instance.onmessage=n._settings.onMessage,n.instance.onopen=function(t){0===n.instance.successCount++&&n._settings.onOpen(t)},n.instance.onerror=function(){event.target.readyState===EventSource.CLOSED&&n._settings.onError(event)};for(var t in n._settings.events)n.instance.addEventListener(t,n._settings.events[t],!1)}function e(n){n.type="ajax",n.instance={successCount:0,id:null,retry:3e3,data:"",event:""},s(n)}function s(t){t.instance&&n.ajax({url:t._url,method:"GET",headers:{"Last-Event-ID":t.instance.id},success:function(n,e,i){if(t.instance){0===t.instance.successCount++&&t._settings.onOpen();var a=n.split("\n");t.instance.data="";var r=0;for(var c in a){var o=a[c].indexOf(":"),u=[a[c].substr(0,o),a[c].substr(o+1)];switch(u[0]){case"":u[1]||1!==r++||(eventMessage={data:t.instance.data,lastEventId:t.instance.id,origin:"http://"+i.getResponseHeader("Host"),returnValue:!0},t.instance.event&&t._settings.events[t.instance.event]?t._settings.events[t.instance.event](eventMessage):t._settings.onMessage(eventMessage),t.instance.data="",t.instance.event="",r=0);break;case"retry":r=0,t.instance.retry=parseInt(u[1].trim());break;case"id":r=0,t.instance.id=u[1].trim();break;case"event":r=0,t.instance.event=u[1].trim();break;case"data":r=0,t.instance.data+=(""!==t.instance.data?"\n":"")+u[1].trim();break;default:r=0}}setTimeout(function(){s(t)},t.instance.retry)}},error:t._settings.onError})}n.extend({SSE:function(s,i){var a={instance:null,type:null},r={onOpen:function(){},onEnd:function(){},onError:function(){},onMessage:function(){},options:{},events:{}};return n.extend(r,i),a._url=s,a._settings=r,a._start=a.start,a.start=function(){return this.instance?!1:(!window.EventSource||this._settings.options.forceAjax?e(this):t(this),!0)},a.stop=function(){return this.instance?(!window.EventSource||this._settings.options.forceAjax||this.instance.close(),this._settings.onEnd(),this.instance=null,this.type=null,!0):!1},a}})}(jQuery);